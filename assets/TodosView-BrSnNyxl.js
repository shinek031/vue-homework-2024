import{d as a,u as A,h as B,i as D,c as h,a as t,t as g,j as u,w as x,v as G,n as $,F,k as I,o as v,l as J}from"./index-D2pty81j.js";import{a as r}from"./axios-BimPEqV4.js";const c="https://todolist-api.hexschool.io",E=`${c}/users/sign_out`,P=`${c}/users/checkout`,R=`${c}/todos`,j=`${c}/todos`,q=p=>`${c}/todos/${p}`,H=p=>`${c}/todos/${p}/toggle`,K={id:"todoListPage",class:"bg-half"},Q=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1),W={class:"todo_sm"},X={href:"#"},Y={class:"conatiner todoListPage vhContainer"},Z={class:"todoList_Content"},ee={class:"inputBox"},te=t("i",{class:"bi bi-plus"},null,-1),se=[te],oe={class:"todoList_list"},ae={class:"todoList_tab"},ne={class:"todoList_items"},le={class:"todoList_item"},ie={class:"todoList_label"},ue=["onUpdate:modelValue","onClick"],re=["onClick"],ce=t("i",{class:"bi bi-x-circle-fill"},null,-1),de=[ce],he={class:"todoList_statistics"},ve={key:0},pe={key:1},fe={__name:"TodosView",setup(p){const f=a(""),n=a(""),y=a(""),m=A(),d=a(""),L=a(""),U=a(!1),l=a("all");B(async()=>{await b()});const b=async()=>{if(n.value=document.cookie.replace(/(?:(?:^|.*;\s*)userTodo\s*\=\s*([^;]*).*$)|^.*$/,"$1"),n.value)try{const e=await r.get(`${P}`,{headers:{Authorization:n.value}});e.data.status==!0&&(f.value=e.data.nickname,await _())}catch{setTimeout(()=>{document.cookie="userTodo=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",m.push({name:"singin"})},3e3)}else setTimeout(()=>{document.cookie="userTodo=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",m.push({name:"singin"})},3e3)},i=a(""),w=a(""),C=a(""),M=D(()=>l.value=="true"?i.value.filter(e=>e.status):l.value=="false"?i.value.filter(e=>!e.status):i.value),z=async()=>{C.value=i.value.filter(e=>e.status),w.value=i.value.filter(e=>!e.status)},S=async e=>{try{await r.delete(`${q(e)}`,{headers:{authorization:n.value}}),_()}catch(s){y.value=s.response.data.message,console.log(s.response.data.message)}},T=e=>{l.value=e},_=async()=>{try{const e=await r.get(`${R}`,{headers:{authorization:n.value}});console.log(e),e.data.status==!0&&(i.value=e.data.data,z())}catch(e){console.log(e.response.data.message)}},N=async()=>{try{if(!d.value){alert(`${f.value.nickname}，您尚未輸入代辦事項唷`);return}const e={content:""};e.content=d.value;const s=await r.post(`${j}`,e,{headers:{authorization:n.value}});L.value=s.data,U.value=!0,d.value="",_()}catch(e){y.value=e.response.data.message}},O=async e=>{if(n.value){console.log("toggleStatus:"+e);try{const s=await r.patch(`${H(e)}`,{},{headers:{Authorization:n.value}});await _()}catch(s){console.log(s.response.data.message)}}},V=async()=>{const e=await r.post(`${E}`,{},{headers:{Authorization:n.value}});console.log(e),e.data.status?document.cookie="userTodo=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/":alert(e.data.message),setTimeout(()=>{m.push({name:"singin"})},3e3)};return(e,s)=>(v(),h("div",K,[t("nav",null,[Q,t("ul",null,[t("li",W,[t("a",X,[t("span",null,g(f.value)+"的代辦",1)])]),t("li",null,[t("a",{href:"#",onClick:u(V,["prevent"])},"登出")])])]),t("div",Y,[t("div",Z,[t("div",ee,[x(t("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=o=>d.value=o),placeholder:"請輸入待辦事項"},null,512),[[G,d.value]]),t("a",{href:"#",onClick:u(N,["prevent"])},se)]),t("div",oe,[t("ul",ae,[t("li",null,[t("a",{href:"#",class:$({active:l.value=="all"}),onClick:s[1]||(s[1]=u(o=>T("all"),["prevent"]))},"全部",2)]),t("li",null,[t("a",{href:"#",class:$({active:l.value=="false"}),onClick:s[2]||(s[2]=u(o=>T("false"),["prevent"]))},"待完成",2)]),t("li",null,[t("a",{href:"#",class:$({active:l.value=="true"}),onClick:s[3]||(s[3]=u(o=>T("true"),["prevent"]))},"已完成",2)])]),t("div",ne,[t("ul",le,[(v(!0),h(F,null,I(M.value,o=>(v(),h("li",{key:o.id},[t("label",ie,[x(t("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":k=>o.status=k,onClick:k=>O(o.id)},null,8,ue),[[J,o.status]]),t("span",null,g(o.content),1)]),t("a",{href:"#",onClick:u(k=>S(o.id),["prevent"])},de,8,re)]))),128))]),t("div",he,[l.value=="true"?(v(),h("p",ve,g(C.value.length)+" 個已完成項目",1)):(v(),h("p",pe,g(w.value.length)+" 個待完成項目",1))])])])])])]))}};export{fe as default};
